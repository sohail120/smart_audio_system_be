<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Processing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .processing-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        .progress {
            height: 10px;
            margin: 20px 0;
        }

        .btn-download {
            background-color: #4361ee;
            color: white;
            font-weight: 600;
            padding: 8px 15px;
            margin: 10px 5px;
            font-size: 14px;
        }

        .processing-icon {
            font-size: 40px;
            color: #4361ee;
            margin-bottom: 15px;
        }

        .downloads-container {
            display: none;
            margin-top: 25px;
        }

        .file-info {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="processing-container">
        <div class="processing-icon">
            <i class="fas fa-cogs fa-spin"></i>
        </div>
        <h4>Processing Your File</h4>

        <div class="file-info">
            <div><strong>File:</strong> <span id="fileName">-</span></div>
            <div><strong>Status:</strong> <span id="fileStatus">Starting...</span></div>
        </div>

        <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated" id="progressBar" role="progressbar"
                style="width: 0%"></div>
        </div>

        <div id="processingMessage">Preparing your file for processing...</div>

        <div class="downloads-container" id="downloadsContainer">
            <h5 class="mb-3">Your file is ready!</h5>
            <button class="btn btn-download" id="finalDownloadBtn">
                <i class="fas fa-download me-1"></i> Download Final Output
            </button>
            <button class="btn btn-download" id="transcriptDownloadBtn">
                <i class="fas fa-download me-1"></i> Download Transcript
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get elements
            const progressBar = document.getElementById('progressBar');
            const processingIcon = document.querySelector('.processing-icon i');
            const processingMessage = document.getElementById('processingMessage');
            const fileNameElement = document.getElementById('fileName');
            const fileStatusElement = document.getElementById('fileStatus');
            const downloadsContainer = document.getElementById('downloadsContainer');
            const finalDownloadBtn = document.getElementById('finalDownloadBtn');
            const transcriptDownloadBtn = document.getElementById('transcriptDownloadBtn');

            // Get file ID from URL or use default
            const fileId = window.location.pathname?.split("/")[2] || '4567890'; // Default for demo

            // Status messages
            const statusMessages = [
                "Starting processing...",
                "Identifying speakers...",
                "Separating speaker segments...",
                "Detecting languages...",
                "Transcribing speech...",
                "Translating content...",
                "Finalizing output..."
            ];

            // // Check file status
            // async function checkFileStatus() {
            //     // In a real app, this would fetch from your API
            //     // For demo, we'll simulate progress
            //     simulateProcessing();

            //     // Real API call would look like this:


            // }

            // Simulate processing for demo
            function updateUI(fileData) {
                console.log("File Data:", statusMessages[fileData.status]);
                // processingMessage.textContent = statusMessages[fileData.status];


            }
            function simulateProcessing() {
                let progress = 0;
                let statusIndex = 0;

                const interval = setInterval(() => {
                    // Update progress
                    progress += Math.random() * 10;
                    if (progress >= 100) progress = 100;
                    progressBar.style.width = progress + '%';

                    // Update status message periodically
                    if (progress % 20 < 5 && statusIndex < statusMessages.length - 1) {
                        statusIndex++;
                        processingMessage.textContent = statusMessages[statusIndex];
                    }

                    // When complete
                    if (progress >= 100) {
                        progress = 0
                    }
                    fetch(`http://localhost:5000/files/${fileId}`, {
                        method: 'GET',
                        headers: { 'accept': 'application/json' }
                    })
                        .then(response => response.json())
                        .then(async (data) => await updateUI(data))
                        .catch(error => console.error('Error:', error));
                }, 5000);
            }

            // When processing is complete
            function processingComplete() {
                // Update UI
                processingIcon.className = 'fas fa-check-circle';
                processingMessage.textContent = "Processing complete!";
                fileStatusElement.textContent = "Ready for download";
                progressBar.className = 'progress-bar bg-success'; // Change to solid green

                // Show download buttons
                downloadsContainer.style.display = 'block';

                // Set file info (in real app this would come from API)
                fileNameElement.textContent = "output_cropped.wav";
            }

            // Download button handlers
            finalDownloadBtn.addEventListener('click', function () {
                alert('Downloading final output file...');
                // In real app: window.location.href = fileData.url;
            });

            transcriptDownloadBtn.addEventListener('click', function () {
                alert('Downloading transcript file...');
                // In real app: window.location.href = transcriptUrl;
            });

            // Start checking status
            simulateProcessing();
        });
    </script>
</body>

</html>